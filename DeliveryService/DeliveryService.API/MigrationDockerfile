FROM mcr.microsoft.com/dotnet/sdk:8.0

WORKDIR /app/deliveryservice

RUN dotnet tool install --global dotnet-ef
ENV PATH="$PATH:/root/.dotnet/tools"

COPY ["DeliveryService/DeliveryService.API/DeliveryService.API.csproj","DeliveryService/DeliveryService.API/"]
COPY ["DeliveryService/DeliveryService.Application/DeliveryService.Application.csproj","DeliveryService/DeliveryService.Application/"]
COPY ["DeliveryService/DeliveryService.Infrastructure/DeliveryService.Infrastructure.csproj","DeliveryService/DeliveryService.Infrastructure/"]
COPY ["DeliveryService/DeliveryService.Domain/DeliveryService.Domain.csproj","DeliveryService/DeliveryService.Domain/"]
COPY ["SharedService/SharedService.Contracts/SharedService.Contracts.csproj","SharedService/SharedService.Contracts/"]

RUN dotnet restore "DeliveryService/DeliveryService.API/DeliveryService.API.csproj"

COPY DeliveryService/DeliveryService.API/ DeliveryService/DeliveryService.API/
COPY DeliveryService/DeliveryService.Application/ DeliveryService/DeliveryService.Application/
COPY DeliveryService/DeliveryService.Infrastructure/ DeliveryService/DeliveryService.Infrastructure/
COPY DeliveryService/DeliveryService.Domain/ DeliveryService/DeliveryService.Domain/
COPY SharedService/SharedService.Contracts/ SharedService/SharedService.Contracts/

ENTRYPOINT ["dotnet","ef","database","update",
  "-p","DeliveryService/DeliveryService.Infrastructure/DeliveryService.Infrastructure.csproj",
  "-s","DeliveryService/DeliveryService.API/DeliveryService.API.csproj",
  "-c","DeliveryService.Infrastructure.Repositories.EF.DeliveryDbContext"]
